# 缓存常见问题

### 缓存穿透

查询一个一定不存在的数据, 导致每次从数据库中查询

解决办法: 最常见的则是采用**布隆过滤器**，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。

### 缓存雪崩

设置固定缓存时间, 导致同一时间缓存大量过期, 请求瞬间全部查询 db, 导致系统崩溃

解决: 设置随机过期时间, 还有一种办法, 设置缓存过期标记, 由单独线程更新缓存

### 缓存击穿

对于单个 key存在超高并发访问, 一旦过期, 会大量并发访问 db.

解决: redis 实现分布式锁, 然后load db 后从缓存查; 或者热点 key 不设置过期

### 缓存一致性问题

常见处理: 先更新数据库，再删除缓存

但是存在极端情况, 如果数据库主从同步太慢, 则:

1. A 更新数据库, 删除缓存

2. B 无法查询到缓存, 查询从库, 得到旧值

3. 从库更新完毕
4. B 将旧值写入缓存

 解决: 异步延时删除, 或者订阅从库 binlog, 然后再次删除?